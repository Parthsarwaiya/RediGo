<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RediGo - 2 Wheeler Rental</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/supabase/2.39.0/umd/supabase.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #2e7d32 0%, #4caf50 50%, #66bb6a 100%);
            min-height: 100vh;
            color: #000000;
        }

        .container {
            max-width: 450px;
            margin: 0 auto;
            padding: 25px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 25px 50px rgba(0,0,0,0.15);
            position: relative;
            border: 2px solid #4caf50;
            min-height: 80vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .admin-container {
            max-width: 1400px;
            margin: 20px auto;
            background: white;
            border-radius: 15px;
            overflow: hidden;
            border: 2px solid #4caf50;
        }

        .logo {
            text-align: center;
            margin-bottom: 30px;
        }

        .logo h1 {
            color: #2e7d32;
            font-size: 2.8em;
            font-weight: bold;
            margin-bottom: 15px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        .logo p {
            color: #000000;
            font-size: 1.1em;
            font-weight: 500;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: #000000;
            font-size: 14px;
        }

        .phone-input-container {
            display: flex;
            align-items: center;
            border: 2px solid #4caf50;
            border-radius: 12px;
            overflow: hidden;
            transition: all 0.3s;
            position: relative;
            background: white;
        }

        .phone-input-container:focus-within {
            border-color: #2e7d32;
            box-shadow: 0 0 0 3px rgba(46, 125, 50, 0.1);
        }

        .phone-input-container.error {
            border-color: #f44336;
            animation: shake 0.5s;
        }

        @keyframes shake {
            0%, 20%, 40%, 60%, 80% { transform: translateX(-2px); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(2px); }
        }

        .country-code {
            background: #e8f5e8;
            padding: 15px 12px;
            border-right: 2px solid #4caf50;
            font-weight: 600;
            color: #2e7d32;
        }

        input[type="tel"], input[type="text"], input[type="password"] {
            flex: 1;
            padding: 15px;
            border: none;
            outline: none;
            font-size: 16px;
            transition: all 0.3s;
            color: #000000;
            background: white;
        }

        input[type="tel"]:invalid {
            color: #f44336;
        }

        input[type="file"] {
            width: 100%;
            padding: 15px;
            border: 2px dashed #4caf50;
            border-radius: 12px;
            background: #e8f5e8;
            cursor: pointer;
            transition: all 0.3s;
            color: #000000;
        }

        input[type="file"]:hover {
            border-color: #2e7d32;
            background: #c8e6c9;
        }

        .file-upload-area {
            text-align: center;
            color: #000000;
        }

        .file-upload-area.has-file {
            color: #2e7d32;
            font-weight: 600;
        }

        .btn {
            width: 100%;
            padding: 16px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .btn-primary {
            background: linear-gradient(135deg, #2e7d32, #4caf50);
            color: white;
            border: 2px solid #2e7d32;
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 12px 25px rgba(46, 125, 50, 0.4);
            background: linear-gradient(135deg, #1b5e20, #2e7d32);
        }

        .btn-success {
            background: #4caf50;
            color: white;
            border: 2px solid #4caf50;
        }

        .btn-success:hover {
            background: #2e7d32;
            border-color: #2e7d32;
        }

        .btn-danger {
            background: #f44336;
            color: white;
            border: 2px solid #f44336;
        }

        .btn-danger:hover {
            background: #d32f2f;
            border-color: #d32f2f;
        }

        .btn-warning {
            background: #ff9800;
            color: #000000;
            border: 2px solid #ff9800;
        }

        .btn-secondary {
            background: #9e9e9e;
            color: white;
            border: 2px solid #9e9e9e;
        }

        .loading {
            position: relative;
        }

        .loading::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 20px;
            height: 20px;
            border: 2px solid transparent;
            border-top: 2px solid currentColor;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            transform: translate(-50%, -50%);
        }

        @keyframes spin {
            0% { transform: translate(-50%, -50%) rotate(0deg); }
            100% { transform: translate(-50%, -50%) rotate(360deg); }
        }

        .hidden {
            display: none !important;
        }

        .waiting-screen {
            text-align: center;
            padding: 50px 20px;
        }

        .waiting-screen .icon {
            font-size: 5em;
            margin-bottom: 25px;
            animation: pulse 2s infinite;
            color: #4caf50;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.8; }
        }

        .waiting-screen h2 {
            color: #2e7d32;
            margin-bottom: 15px;
        }

        .waiting-screen p {
            color: #000000;
        }

        .contact-info {
            background: linear-gradient(135deg, #e8f5e8, #c8e6c9);
            padding: 25px;
            border-radius: 15px;
            margin-top: 25px;
            border-left: 4px solid #2e7d32;
        }

        .contact-info h3 {
            color: #2e7d32;
            margin-bottom: 10px;
        }

        .contact-info p {
            color: #000000;
            margin-bottom: 5px;
        }

        .contact-info a {
            color: #2e7d32;
            text-decoration: none;
            font-weight: bold;
            font-size: 1.2em;
        }

        .stations-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }

        .station-card {
            background: linear-gradient(135deg, #fff, #e8f5e8);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.08);
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid #4caf50;
            position: relative;
            overflow: hidden;
        }

        .station-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(135deg, #2e7d32, #4caf50);
        }

        .station-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 35px rgba(46, 125, 50, 0.15);
            border-color: #2e7d32;
        }

        .station-card.unavailable {
            opacity: 0.6;
            cursor: not-allowed;
            border-color: #9e9e9e;
        }

        .station-name {
            font-size: 1.3em;
            font-weight: bold;
            color: #2e7d32;
            margin-bottom: 12px;
        }

        .vehicle-count {
            color: #4caf50;
            font-weight: 600;
            font-size: 1.1em;
        }

        .vehicle-count.zero {
            color: #f44336;
        }

        .vehicles-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }

        .vehicle-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid #4caf50;
            position: relative;
        }

        .vehicle-card:hover {
            transform: scale(1.03);
            box-shadow: 0 12px 30px rgba(0,0,0,0.15);
            border-color: #2e7d32;
        }

        .vehicle-card.unavailable {
            opacity: 0.5;
            cursor: not-allowed;
            border-color: #9e9e9e;
        }

        .vehicle-image {
            width: 100%;
            height: 140px;
            background: linear-gradient(135deg, #e8f5e8, #c8e6c9);
            border-radius: 12px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3.5em;
            color: #2e7d32;
            position: relative;
            overflow: hidden;
        }

        .vehicle-image::after {
            content: 'Available';
            position: absolute;
            top: 10px;
            right: 10px;
            background: #4caf50;
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
        }

        .vehicle-info h4 {
            color: #000000;
            margin-bottom: 8px;
            font-size: 1.2em;
        }

        .vehicle-info p {
            color: #424242;
            font-weight: 500;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.6);
            z-index: 1000;
            backdrop-filter: blur(5px);
        }

        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: white;
            padding: 35px;
            border-radius: 20px;
            max-width: 500px;
            width: 90%;
            max-height: 85vh;
            overflow-y: auto;
            position: relative;
            animation: slideUp 0.3s;
            border: 2px solid #4caf50;
        }

        @keyframes slideUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-header {
            text-align: center;
            margin-bottom: 25px;
        }

        .modal-header h3 {
            color: #2e7d32;
            margin-bottom: 10px;
        }

        .modal-header p {
            color: #000000;
        }

        .time-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 15px;
            margin: 25px 0;
        }

        .time-option {
            padding: 20px 15px;
            border: 2px solid #4caf50;
            border-radius: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background: white;
        }

        .time-option:hover {
            border-color: #2e7d32;
            background: #e8f5e8;
            transform: translateY(-2px);
        }

        .time-option.selected {
            border-color: #2e7d32;
            background: linear-gradient(135deg, #e8f5e8, #c8e6c9);
            box-shadow: 0 5px 15px rgba(46, 125, 50, 0.2);
        }

        .time-option-title {
            font-weight: bold;
            color: #000000;
            margin-bottom: 5px;
        }

        .time-option-price {
            color: #2e7d32;
            font-weight: 600;
        }

        .admin-dashboard {
            display: grid;
            grid-template-columns: 280px 1fr;
            min-height: 100vh;
        }

        .sidebar {
            background: linear-gradient(180deg, #1b5e20 0%, #2e7d32 100%);
            padding: 25px;
            color: white;
        }

        .sidebar-header {
            text-align: center;
            margin-bottom: 35px;
            padding-bottom: 25px;
            border-bottom: 1px solid #4caf50;
        }

        .sidebar-header h2 {
            color: white;
            font-size: 1.8em;
        }

        .sidebar-item {
            padding: 15px 20px;
            margin: 8px 0;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 12px;
            color: white;
        }

        .sidebar-item:hover {
            background: rgba(255,255,255,0.1);
            transform: translateX(5px);
        }

        .sidebar-item.active {
            background: linear-gradient(135deg, #4caf50, #66bb6a);
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.3);
        }

        .main-content {
            padding: 30px;
            background: #f1f8e9;
            overflow-y: auto;
        }

        .content-header {
            margin-bottom: 30px;
        }

        .content-header h2 {
            color: #000000;
            margin-bottom: 10px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            border-left: 4px solid #4caf50;
            border: 2px solid #e8f5e8;
        }

        .stat-value {
            font-size: 2.5em;
            font-weight: bold;
            color: #2e7d32;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #000000;
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .approval-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            border: 2px solid #e8f5e8;
        }

        .approval-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .user-info h4 {
            color: #000000;
            margin-bottom: 5px;
        }

        .user-info p {
            color: #424242;
        }

        .approval-actions {
            display: flex;
            gap: 10px;
        }

        .approval-actions .btn {
            width: auto;
            padding: 8px 16px;
            font-size: 14px;
        }

        .documents-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .document-preview {
            border: 2px dashed #4caf50;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            background: #e8f5e8;
            color: #000000;
        }

        .timer {
            font-size: 3em;
            font-weight: bold;
            color: #2e7d32;
            text-align: center;
            margin: 30px 0;
            font-family: 'Courier New', monospace;
            background: linear-gradient(135deg, #e8f5e8, #c8e6c9);
            padding: 25px;
            border-radius: 15px;
            border: 3px solid #4caf50;
        }

        .fare-display {
            background: linear-gradient(135deg, #e8f5e8, #c8e6c9);
            padding: 25px;
            border-radius: 15px;
            margin: 20px 0;
            border-left: 4px solid #4caf50;
            border: 2px solid #4caf50;
        }

        .fare-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding: 8px 0;
            color: #000000;
        }

        .fare-row:last-child {
            border-top: 2px solid #4caf50;
            font-weight: bold;
            color: #2e7d32;
            font-size: 1.1em;
        }

        .success-message {
            text-align: center;
            color: #2e7d32;
            font-size: 1.3em;
            margin: 25px 0;
            padding: 20px;
            background: #c8e6c9;
            border-radius: 10px;
            border: 2px solid #4caf50;
        }

        .error-message {
            text-align: center;
            color: #f44336;
            font-size: 1em;
            margin: 15px 0;
            padding: 15px;
            background: #ffcdd2;
            border-radius: 10px;
            border: 2px solid #f44336;
        }

        .notification-popup {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.15);
            z-index: 1001;
            max-width: 350px;
            border-left: 4px solid #4caf50;
            border: 2px solid #4caf50;
            animation: slideInRight 0.3s;
        }

        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .back-btn {
            position: absolute;
            top: 20px;
            left: 20px;
            background: #4caf50;
            color: white;
            border: 2px solid #2e7d32;
            border-radius: 50%;
            width: 45px;
            height: 45px;
            font-size: 20px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .back-btn:hover {
            background: #2e7d32;
            transform: scale(1.1);
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: #e8f5e8;
            border-radius: 3px;
            overflow: hidden;
            margin: 20px 0;
            border: 1px solid #4caf50;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #2e7d32, #4caf50);
            border-radius: 3px;
            transition: width 0.3s;
        }

        @media (max-width: 768px) {
            .admin-dashboard {
                grid-template-columns: 1fr;
            }
            
            .sidebar {
                order: 2;
                padding: 15px;
            }

            .container {
                margin: 15px;
                padding: 20px;
            }

            .stations-grid, .vehicles-grid {
                grid-template-columns: 1fr;
            }

            .modal-content {
                padding: 25px;
                margin: 20px;
            }
        }

        @media print {
            .sidebar, .btn, .modal { display: none !important; }
            .main-content { padding: 0 !important; }
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div id="loginScreen" class="container">
        <div class="logo">
            <h1>RediGo</h1>
            <p>Premium 2-Wheeler Rentals</p>
        </div>
        
        <form id="loginForm">
            <div class="form-group">
                <label for="phoneNumber">Mobile Number</label>
                <div class="phone-input-container" id="phoneContainer">
                    <span class="country-code">+91</span>
                    <input type="tel" id="phoneNumber" placeholder="Enter 10-digit number" maxlength="10" required pattern="[0-9]{10}">
                </div>
                <div id="phoneError" class="error-message hidden">Please enter a valid 10-digit mobile number</div>
            </div>
            <button type="submit" class="btn btn-primary" id="loginBtn">
                <span class="btn-text">Send OTP</span>
            </button>
        </form>
        
        <div class="progress-bar">
            <div class="progress-fill" style="width: 20%"></div>
        </div>
    </div>

    <!-- OTP Screen -->
    <div id="otpScreen" class="container hidden">
        <button class="back-btn" onclick="goBack('loginScreen')" title="Go Back">‚Üê</button>
        <div class="logo">
            <h1>RediGo</h1>
            <p>Enter Verification Code</p>
        </div>
        
        <form id="otpForm">
            <div class="form-group">
                <label for="otpInput">Enter 6-digit OTP</label>
                <div class="phone-input-container" id="otpContainer">
                    <input type="text" id="otpInput" placeholder="000000" maxlength="6" required pattern="[0-9]{6}">
                </div>
                <div id="otpError" class="error-message hidden">Please enter a valid 6-digit OTP</div>
                <p style="text-align: center; color: #000000; font-size: 14px; margin-top: 10px;">
                    OTP sent to +91 <span id="displayPhone"></span>
                </p>
            </div>
            <button type="submit" class="btn btn-primary" id="otpBtn">
                <span class="btn-text">Verify OTP</span>
            </button>
            
            <button type="button" class="btn btn-secondary" id="resendBtn" style="margin-top: 10px;" onclick="resendOTP()">
                <span class="btn-text">Resend OTP</span>
            </button>
        </form>
        
        <div class="progress-bar">
            <div class="progress-fill" style="width: 40%"></div>
        </div>
    </div>

    <!-- Admin Password Screen -->
    <div id="adminPasswordScreen" class="container hidden">
        <button class="back-btn" onclick="goBack('loginScreen')" title="Go Back">‚Üê</button>
        <div class="logo">
            <h1>RediGo Admin</h1>
            <p>Enter Admin Password</p>
        </div>
        
        <form id="adminPasswordForm">
            <div class="form-group">
                <label for="adminPassword">Admin Password</label>
                <div class="phone-input-container" id="passwordContainer">
                    <input type="password" id="adminPassword" placeholder="Enter password" required>
                </div>
                <div id="passwordError" class="error-message hidden">Invalid password</div>
            </div>
            <button type="submit" class="btn btn-primary" id="adminBtn">
                <span class="btn-text">Login</span>
            </button>
        </form>
    </div>

    <!-- Registration Screen -->
    <div id="registrationScreen" class="container hidden">
        <button class="back-btn" onclick="goBack('otpScreen')" title="Go Back">‚Üê</button>
        <div class="logo">
            <h1>Complete Registration</h1>
            <p>Upload your documents</p>
        </div>
        
        <form id="registrationForm">
            <div class="form-group">
                <label for="userName">Full Name</label>
                <div class="phone-input-container">
                    <input type="text" id="userName" placeholder="Enter your full name" required>
                </div>
            </div>
            
            <div class="form-group">
                <label for="drivingLicense">Upload Driving License</label>
                <input type="file" id="drivingLicense" accept="image/*" required>
                <div class="file-upload-area" id="dlArea">Click to upload DL image</div>
            </div>
            
            <div class="form-group">
                <label for="panCard">Upload PAN Card</label>
                <input type="file" id="panCard" accept="image/*" required>
                <div class="file-upload-area" id="panArea">Click to upload PAN image</div>
            </div>
            
            <button type="submit" class="btn btn-primary" id="regBtn">
                <span class="btn-text">Submit for Approval</span>
            </button>
        </form>
        
        <div class="progress-bar">
            <div class="progress-fill" style="width: 60%"></div>
        </div>
    </div>

    <!-- Waiting for Approval Screen -->
    <div id="waitingScreen" class="container hidden">
        <div class="waiting-screen">
            <div class="icon">‚è≥</div>
            <h2>Waiting for Approval</h2>
            <p>Your documents are being reviewed by our team</p>
            
            <div class="contact-info">
                <h3>For quick approval, call:</h3>
                <p><strong>Siddhar Singh Rajavath</strong></p>
                <p><a href="tel:+919260312701">üìû +91 9260 312701</a></p>
            </div>
            
            <button onclick="checkApprovalStatus()" class="btn btn-primary" style="margin-top: 20px;">
                Check Status
            </button>
        </div>
        
        <div class="progress-bar">
            <div class="progress-fill" style="width: 80%"></div>
        </div>
    </div>

    <!-- Stations Screen -->
    <div id="stationsScreen" class="container hidden">
        <div class="logo">
            <h1>Select Station</h1>
            <p>Choose your pickup location</p>
        </div>
        
        <div class="stations-grid">
            <div class="station-card" onclick="selectStation('sattasai')" id="sattasaiCard">
                <div class="station-name">üìç Sattasai Square</div>
                <div class="vehicle-count" id="sattasaiCount">16 vehicles available</div>
            </div>
            
            <div class="station-card unavailable" onclick="selectStation('mr13')" id="mr13Card">
                <div class="station-name">üìç MR 13</div>
                <div class="vehicle-count zero" id="mr13Count">0 vehicles available</div>
            </div>
            
            <div class="station-card unavailable" onclick="selectStation('mr11')" id="mr11Card">
                <div class="station-name">üìç MR 11</div>
                <div class="vehicle-count zero" id="mr11Count">0 vehicles available</div>
            </div>
        </div>
        
        <div class="progress-bar">
            <div class="progress-fill" style="width: 100%"></div>
        </div>
    </div>

    <!-- Vehicles Screen -->
    <div id="vehiclesScreen" class="container hidden">
        <button class="back-btn" onclick="goBack('stationsScreen')" title="Go Back">‚Üê</button>
        <div class="logo">
            <h1>Available Vehicles</h1>
            <p>Choose your ride</p>
        </div>
        
        <div class="vehicles-grid" id="vehiclesList">
            <!-- Vehicles will be populated here -->
        </div>
    </div>

    <!-- Active Ride Screen -->
    <div id="activeRideScreen" class="container hidden">
        <div class="logo">
            <h1>Active Ride</h1>
            <p>Enjoy your journey</p>
        </div>
        
        <div class="timer" id="rideTimer">00:00:00</div>
        
        <div class="fare-display">
            <div class="fare-row">
                <span>Current Fare:</span>
                <span>‚Çπ<span id="currentFare">0</span></span>
            </div>
            <div class="fare-row">
                <span>Rate:</span>
                <span>‚Çπ60/hour</span>
            </div>
            <div class="fare-row">
                <span>Deposit Paid:</span>
                <span>‚Çπ300</span>
            </div>
            <div class="fare-row">
                <span>Total Amount:</span>
                <span>‚Çπ<span id="totalAmount">300</span></span>
            </div>
        </div>
        
        <div style="text-align: center; margin: 20px 0;">
            <p style="color: #000000; font-weight: 600;">Vehicle: <span id="rideVehicleInfo"></span></p>
        </div>
        
        <button onclick="endRide()" class="btn btn-danger" id="endRideBtn">
            <span class="btn-text">End Ride</span>
        </button>
    </div>

    <!-- Booking Confirmation Screen -->
    <div id="bookingConfirmScreen" class="container hidden">
        <div class="logo">
            <h1>Booking Confirmed</h1>
            <p>Get ready to ride</p>
        </div>
        
        <div class="success-message">
            <h3>‚úÖ Booking Successful!</h3>
            <p>Your ride will start once admin approves</p>
        </div>
        
        <div id="bookingDetails" class="fare-display">
            <!-- Booking details will be shown here -->
        </div>
        
        <button onclick="checkBookingStatus()" class="btn btn-primary">
            Check Status
        </button>
    </div>

    <!-- Admin Dashboard -->
    <div id="adminDashboard" class="admin-container hidden">
        <div class="admin-dashboard">
            <div class="sidebar">
                <div class="sidebar-header">
                    <h2>RediGo Admin</h2>
                    <p style="color: #c8e6c9; font-size: 0.9em;">Management Panel</p>
                </div>
                
                <div class="sidebar-item active" onclick="showAdminSection('dashboard')" data-section="dashboard">
                    üìä Dashboard
                </div>
                <div class="sidebar-item" onclick="showAdminSection('user-approvals')" data-section="user-approvals">
                    üë• User Approvals
                </div>
                <div class="sidebar-item" onclick="showAdminSection('booking-approvals')" data-section="booking-approvals">
                    üé´ Booking Approvals
                </div>
                <div class="sidebar-item" onclick="showAdminSection('active-rides')" data-section="active-rides">
                    üèçÔ∏è Active Rides
                </div>
                <div class="sidebar-item" onclick="showAdminSection('users')" data-section="users">
                    üìã All Users
                </div>
                <div class="sidebar-item" onclick="showAdminSection('vehicles')" data-section="vehicles">
                    üö≤ Vehicle Management
                </div>
                <div class="sidebar-item" onclick="showAdminSection('analytics')" data-section="analytics">
                    üìà Analytics
                </div>
                <div class="sidebar-item" onclick="logout()">
                    üö™ Logout
                </div>
            </div>
            
            <div class="main-content">
                <!-- Dashboard Section -->
                <div id="dashboardSection" class="admin-section">
                    <div class="content-header">
                        <h2>Dashboard Overview</h2>
                        <p style="color: #424242;">Real-time business metrics</p>
                    </div>
                    
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-value" id="totalUsersCount">0</div>
                            <div class="stat-label">Total Users</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="activeRidesCount">0</div>
                            <div class="stat-label">Active Rides</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">‚Çπ<span id="todayRevenueCount">0</span></div>
                            <div class="stat-label">Today's Revenue</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="availableVehiclesCount">16</div>
                            <div class="stat-label">Available Vehicles</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="pendingApprovalsCount">0</div>
                            <div class="stat-label">Pending Approvals</div>
                        </div>
                    </div>
                </div>
                
                <!-- User Approvals Section -->
                <div id="userApprovalsSection" class="admin-section hidden">
                    <div class="content-header">
                        <h2>User Approvals</h2>
                        <p style="color: #424242;">Review and approve new user registrations</p>
                    </div>
                    
                    <div id="pendingUserApprovals">
                        <!-- Pending user approvals will be shown here -->
                    </div>
                </div>
                
                <!-- Booking Approvals Section -->
                <div id="bookingApprovalsSection" class="admin-section hidden">
                    <div class="content-header">
                        <h2>Booking Approvals</h2>
                        <p style="color: #424242;">Approve ride bookings</p>
                    </div>
                    
                    <div id="pendingBookingApprovals">
                        <!-- Pending booking approvals will be shown here -->
                    </div>
                </div>
                
                <!-- Active Rides Section -->
                <div id="activeRidesSection" class="admin-section hidden">
                    <div class="content-header">
                        <h2>Active Rides</h2>
                        <p style="color: #424242;">Monitor ongoing rides</p>
                    </div>
                    
                    <div id="activeRidesList">
                        <!-- Active rides will be shown here -->
                    </div>
                </div>
                
                <!-- All Users Section -->
                <div id="usersSection" class="admin-section hidden">
                    <div class="content-header">
                        <h2>User Management</h2>
                        <p style="color: #424242;">View and manage all users</p>
                    </div>
                    
                    <div id="allUsersList">
                        <!-- All users will be shown here -->
                    </div>
                </div>
                
                <!-- Vehicle Management Section -->
                <div id="vehiclesSection" class="admin-section hidden">
                    <div class="content-header">
                        <h2>Vehicle Management</h2>
                        <p style="color: #424242;">Manage fleet and availability</p>
                    </div>
                    
                    <div id="vehicleManagement">
                        <!-- Vehicle management will be shown here -->
                    </div>
                </div>
                
                <!-- Analytics Section -->
                <div id="analyticsSection" class="admin-section hidden">
                    <div class="content-header">
                        <h2>Analytics</h2>
                        <p style="color: #424242;">Business insights and reports</p>
                    </div>
                    
                    <div id="analyticsData">
                        <!-- Analytics will be shown here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Booking Modal -->
    <div id="bookingModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Book Vehicle</h3>
                <p id="selectedVehicleInfo">Select your booking duration</p>
            </div>
            
            <div class="time-options">
                <div class="time-option" onclick="selectDuration('hourly')" data-duration="hourly">
                    <div class="time-option-title">Hourly</div>
                    <div class="time-option-price">‚Çπ60/hr</div>
                </div>
                <div class="time-option" onclick="selectDuration('12hour')" data-duration="12hour">
                    <div class="time-option-title">12 Hours</div>
                    <div class="time-option-price">‚Çπ720</div>
                </div>
                <div class="time-option" onclick="selectDuration('24hour')" data-duration="24hour">
                    <div class="time-option-title">24 Hours</div>
                    <div class="time-option-price">‚Çπ1440</div>
                </div>
            </div>
            
            <div class="fare-display">
                <div class="fare-row">
                    <span>Deposit Required:</span>
                    <span>‚Çπ300</span>
                </div>
                <div class="fare-row">
                    <span>Advance Payment:</span>
                    <span id="advanceAmount">‚Çπ0</span>
                </div>
                <div class="fare-row">
                    <span><strong>Total to Pay:</strong></span>
                    <span><strong>‚Çπ<span id="totalPayAmount">300</span></strong></span>
                </div>
            </div>
            
            <button onclick="proceedToPayment()" class="btn btn-primary" id="paymentBtn" disabled>
                <span class="btn-text">Proceed to Payment</span>
            </button>
            <button onclick="closeModal()" class="btn btn-secondary" style="margin-top: 10px;">
                Cancel
            </button>
        </div>
    </div>

    <!-- JavaScript -->
    <script>
        // Supabase configuration (replace with your actual credentials)
        const supabaseUrl = 'https://your-project-ref.supabase.co';
        const supabaseKey = 'your-anon-public-key';
        // For demo purposes, we'll use localStorage
        // const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

        // Global variables
        let currentUser = null;
        let currentVehicle = null;
        let selectedDuration = null;
        let selectedStation = null;
        let rideStartTime = null;
        let rideTimer = null;
        let currentBooking = null;

        // Admin phone numbers
        const adminNumbers = ['9510578353', '9260312701'];

        // Mock data for demo
        let users = JSON.parse(localStorage.getItem('redigo_users') || '[]');
        let bookings = JSON.parse(localStorage.getItem('redigo_bookings') || '[]');
        let vehicles = [
            { id: 1, name: 'Honda Activa', number: 'MP04AB1234', station: 'sattasai', available: true },
            { id: 2, name: 'TVS Jupiter', number: 'MP04AB1235', station: 'sattasai', available: true },
            { id: 3, name: 'Hero Maestro', number: 'MP04AB1236', station: 'sattasai', available: true },
            { id: 4, name: 'Suzuki Access', number: 'MP04AB1237', station: 'sattasai', available: true },
            { id: 5, name: 'Yamaha Fascino', number: 'MP04AB1238', station: 'sattasai', available: true },
            { id: 6, name: 'Honda Dio', number: 'MP04AB1239', station: 'sattasai', available: true },
            { id: 7, name: 'TVS Ntorq', number: 'MP04AB1240', station: 'sattasai', available: true },
            { id: 8, name: 'Hero Pleasure', number: 'MP04AB1241', station: 'sattasai', available: true },
            { id: 9, name: 'Bajaj Chetak', number: 'MP04AB1242', station: 'sattasai', available: true },
            { id: 10, name: 'Ola S1', number: 'MP04AB1243', station: 'sattasai', available: true },
            { id: 11, name: 'Ather 450X', number: 'MP04AB1244', station: 'sattasai', available: true },
            { id: 12, name: 'TVS iQube', number: 'MP04AB1245', station: 'sattasai', available: true },
            { id: 13, name: 'Hero Optima', number: 'MP04AB1246', station: 'sattasai', available: true },
            { id: 14, name: 'Honda Grazia', number: 'MP04AB1247', station: 'sattasai', available: true },
            { id: 15, name: 'Yamaha Ray ZR', number: 'MP04AB1248', station: 'sattasai', available: true },
            { id: 16, name: 'Suzuki Burgman', number: 'MP04AB1249', station: 'sattasai', available: true },
        ];

        // Utility functions
        function showScreen(screenId) {
            document.querySelectorAll('.container, .admin-container').forEach(screen => {
                screen.classList.add('hidden');
            });
            document.getElementById(screenId).classList.remove('hidden');
        }

        function goBack(screenId) {
            showScreen(screenId);
        }

        function showLoading(button) {
            if (button) {
                button.classList.add('loading');
                button.disabled = true;
            }
        }

        function hideLoading(button, originalText) {
            if (button) {
                button.classList.remove('loading');
                button.disabled = false;
                if (originalText) {
                    button.querySelector('.btn-text').textContent = originalText;
                }
            }
        }

        function showError(containerId, message) {
            const container = document.getElementById(containerId);
            const errorDiv = document.getElementById(containerId.replace('Container', 'Error'));
            if (container && errorDiv) {
                container.classList.add('error');
                errorDiv.classList.remove('hidden');
                errorDiv.textContent = message;
                setTimeout(() => {
                    container.classList.remove('error');
                    errorDiv.classList.add('hidden');
                }, 3000);
            }
        }

        function generateOTP() {
            return Math.floor(100000 + Math.random() * 900000).toString();
        }

        function saveToLocalStorage(key, data) {
            localStorage.setItem(key, JSON.stringify(data));
        }

        // Login form handler
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const phoneInput = document.getElementById('phoneNumber');
            const loginBtn = document.getElementById('loginBtn');
            const phoneNumber = phoneInput.value.trim();
            
            // Validation
            if (!/^[0-9]{10}$/.test(phoneNumber)) {
                showError('phoneContainer', 'Please enter a valid 10-digit mobile number');
                return;
            }

            showLoading(loginBtn);
            
            // Simulate API call
            setTimeout(() => {
                currentUser = { phone: phoneNumber };
                document.getElementById('displayPhone').textContent = phoneNumber;
                
                // Check if admin
                if (adminNumbers.includes(phoneNumber)) {
                    hideLoading(loginBtn, 'Send OTP');
                    showScreen('adminPasswordScreen');
                } else {
                    // Generate and store OTP (in real app, send via SMS)
                    const otp = generateOTP();
                    sessionStorage.setItem('currentOTP', otp);
                    console.log('Generated OTP:', otp); // For demo purposes
                    
                    hideLoading(loginBtn, 'Send OTP');
                    showScreen('otpScreen');
                }
            }, 1500);
        });

        // OTP form handler
        document.getElementById('otpForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const otpInput = document.getElementById('otpInput');
            const otpBtn = document.getElementById('otpBtn');
            const otp = otpInput.value.trim();
            
            // Validation
            if (!/^[0-9]{6}$/.test(otp)) {
                showError('otpContainer', 'Please enter a valid 6-digit OTP');
                return;
            }

            showLoading(otpBtn);
            
            // Simulate API call
            setTimeout(() => {
                const storedOTP = sessionStorage.getItem('currentOTP');
                
                if (otp === storedOTP || otp === '123456') { // 123456 for demo
                    // Check if user exists
                    const existingUser = users.find(u => u.phone === currentUser.phone);
                    
                    if (existingUser) {
                        if (existingUser.approved) {
                            // Check if user has active ride
                            const activeRide = bookings.find(b => 
                                b.userPhone === currentUser.phone && b.status === 'active'
                            );
                            
                            if (activeRide) {
                                loadActiveRide(activeRide);
                            } else {
                                showScreen('stationsScreen');
                            }
                        } else {
                            showScreen('waitingScreen');
                        }
                    } else {
                        showScreen('registrationScreen');
                    }
                    
                    hideLoading(otpBtn, 'Verify OTP');
                } else {
                    hideLoading(otpBtn, 'Verify OTP');
                    showError('otpContainer', 'Invalid OTP. Please try again');
                }
            }, 1500);
        });

        // Admin password form handler
        document.getElementById('adminPasswordForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const passwordInput = document.getElementById('adminPassword');
            const adminBtn = document.getElementById('adminBtn');
            const password = passwordInput.value;
            
            showLoading(adminBtn);
            
            setTimeout(() => {
                if (password === 'admin123' || password === 'redigo2024') {
                    currentUser.isAdmin = true;
                    hideLoading(adminBtn, 'Login');
                    showScreen('adminDashboard');
                    loadAdminData();
                } else {
                    hideLoading(adminBtn, 'Login');
                    showError('passwordContainer', 'Invalid password');
                }
            }, 1000);
        });

        // Registration form handler
        document.getElementById('registrationForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const nameInput = document.getElementById('userName');
            const dlInput = document.getElementById('drivingLicense');
            const panInput = document.getElementById('panCard');
            const regBtn = document.getElementById('regBtn');
            
            const name = nameInput.value.trim();
            const dlFile = dlInput.files[0];
            const panFile = panInput.files[0];
            
            if (!name || !dlFile || !panFile) {
                alert('Please fill all fields and upload required documents');
                return;
            }

            showLoading(regBtn);
            
            // Simulate file upload and user creation
            setTimeout(() => {
                const userData = {
                    phone: currentUser.phone,
                    name: name,
                    dlDocument: dlFile.name,
                    panDocument: panFile.name,
                    approved: false,
                    registeredAt: new Date().toISOString()
                };
                
                users.push(userData);
                saveToLocalStorage('redigo_users', users);
                
                hideLoading(regBtn, 'Submit for Approval');
                showScreen('waitingScreen');
                
                // Notify admin (in real app, would be real-time)
                if (typeof showNewUserNotification === 'function') {
                    showNewUserNotification(userData);
                }
            }, 2000);
        });

        // File upload handlers
        document.getElementById('drivingLicense').addEventListener('change', function(e) {
            const area = document.getElementById('dlArea');
            if (e.target.files[0]) {
                area.textContent = `Selected: ${e.target.files[0].name}`;
                area.classList.add('has-file');
            }
        });

        document.getElementById('panCard').addEventListener('change', function(e) {
            const area = document.getElementById('panArea');
            if (e.target.files[0]) {
                area.textContent = `Selected: ${e.target.files[0].name}`;
                area.classList.add('has-file');
            }
        });

        // Resend OTP function
        function resendOTP() {
            const resendBtn = document.getElementById('resendBtn');
            showLoading(resendBtn);
            
            setTimeout(() => {
                const otp = generateOTP();
                sessionStorage.setItem('currentOTP', otp);
                console.log('New OTP:', otp); // For demo purposes
                
                hideLoading(resendBtn, 'Resend OTP');
                alert('New OTP sent successfully!');
            }, 1000);
        }

        // Check approval status
        function checkApprovalStatus() {
            const checkBtn = event.target;
            showLoading(checkBtn);
            
            setTimeout(() => {
                const user = users.find(u => u.phone === currentUser.phone);
                if (user && user.approved) {
                    hideLoading(checkBtn, 'Check Status');
                    showNotification('Your account has been approved! Redirecting to stations...', 'success');
                    setTimeout(() => {
                        showScreen('stationsScreen');
                        updateStationAvailability();
                    }, 1500);
                } else {
                    hideLoading(checkBtn, 'Check Status');
                    showNotification('Your application is still under review. Please wait for admin approval.', 'warning');
                }
            }, 1000);
        }

        // Check for booking approval status
        function checkBookingApprovalStatus() {
            if (currentBooking) {
                const booking = bookings.find(b => b.id === currentBooking.id);
                if (booking && booking.status === 'active') {
                    showNotification('Your booking has been approved! Starting your ride...', 'success');
                    setTimeout(() => {
                        loadActiveRide(booking);
                    }, 1500);
                    return true;
                }
            }
            return false;
        }

        // Enhanced check approval status for booking confirmation screen
        function checkBookingStatus() {
            const checkBtn = event.target;
            showLoading(checkBtn);
            
            setTimeout(() => {
                if (checkBookingApprovalStatus()) {
                    hideLoading(checkBtn, 'Check Status');
                } else {
                    hideLoading(checkBtn, 'Check Status');
                    showNotification('Your booking is still pending admin approval. Please wait...', 'warning');
                }
            }, 1000);
        }

        // Update station availability display
        function updateStationAvailability() {
            const sattasaiCount = vehicles.filter(v => v.station === 'sattasai' && v.available).length;
            const mr13Count = vehicles.filter(v => v.station === 'mr13' && v.available).length;
            const mr11Count = vehicles.filter(v => v.station === 'mr11' && v.available).length;
            
            document.getElementById('sattasaiCount').textContent = `${sattasaiCount} vehicles available`;
            document.getElementById('mr13Count').textContent = `${mr13Count} vehicles available`;
            document.getElementById('mr11Count').textContent = `${mr11Count} vehicles available`;
            
            // Update card states
            const sattasaiCard = document.getElementById('sattasaiCard');
            const mr13Card = document.getElementById('mr13Card');
            const mr11Card = document.getElementById('mr11Card');
            
            if (sattasaiCount === 0) {
                sattasaiCard.classList.add('unavailable');
                document.getElementById('sattasaiCount').classList.add('zero');
            } else {
                sattasaiCard.classList.remove('unavailable');
                document.getElementById('sattasaiCount').classList.remove('zero');
            }
            
            if (mr13Count === 0) {
                mr13Card.classList.add('unavailable');
                document.getElementById('mr13Count').classList.add('zero');
            } else {
                mr13Card.classList.remove('unavailable');
                document.getElementById('mr13Count').classList.remove('zero');
            }
            
            if (mr11Count === 0) {
                mr11Card.classList.add('unavailable');
                document.getElementById('mr11Count').classList.add('zero');
            } else {
                mr11Card.classList.remove('unavailable');
                document.getElementById('mr11Count').classList.remove('zero');
            }
        }

        // Station selection
        function selectStation(stationId) {
            selectedStation = stationId;
            
            const availableVehicles = vehicles.filter(v => v.station === stationId && v.available);
            
            if (availableVehicles.length === 0) {
                showNotification('No vehicles available at this station currently. Please try another station or check back later.', 'warning');
                return;
            }
            
            displayVehicles(availableVehicles);
            showScreen('vehiclesScreen');
        }

        // Display vehicles
        function displayVehicles(vehicleList) {
            const container = document.getElementById('vehiclesList');
            container.innerHTML = '';
            
            if (vehicleList.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 50px; color: #666;">No vehicles available at this station</div>';
                return;
            }
            
            vehicleList.forEach(vehicle => {
                const vehicleCard = document.createElement('div');
                vehicleCard.className = 'vehicle-card';
                if (!vehicle.available) {
                    vehicleCard.classList.add('unavailable');
                }
                vehicleCard.onclick = () => selectVehicle(vehicle);
                
                vehicleCard.innerHTML = `
                    <div class="vehicle-image">üèçÔ∏è</div>
                    <div class="vehicle-info">
                        <h4>${vehicle.name}</h4>
                        <p>${vehicle.number}</p>
                        <p style="color: ${vehicle.available ? '#4caf50' : '#f44336'}; font-weight: bold; font-size: 0.9em;">
                            ${vehicle.available ? '‚úÖ Available' : '‚ùå In Use'}
                        </p>
                    </div>
                `;
                
                container.appendChild(vehicleCard);
            });
        }

        // Select vehicle
        function selectVehicle(vehicle) {
            if (!vehicle.available) {
                alert('This vehicle is not available');
                return;
            }
            
            currentVehicle = vehicle;
            document.getElementById('selectedVehicleInfo').textContent = 
                `${vehicle.name} (${vehicle.number})`;
            document.getElementById('bookingModal').classList.add('show');
        }

        // Select duration
        function selectDuration(duration) {
            document.querySelectorAll('.time-option').forEach(option => {
                option.classList.remove('selected');
            });
            event.target.closest('.time-option').classList.add('selected');
            selectedDuration = duration;
            
            let advanceAmount = 0;
            const deposit = 300;
            
            if (duration === '12hour') advanceAmount = 720;
            if (duration === '24hour') advanceAmount = 1440;
            
            document.getElementById('advanceAmount').textContent = `‚Çπ${advanceAmount}`;
            document.getElementById('totalPayAmount').textContent = deposit + advanceAmount;
            document.getElementById('paymentBtn').disabled = false;
        }

        // Proceed to payment
        function proceedToPayment() {
            if (!selectedDuration) {
                alert('Please select a duration');
                return;
            }
            
            const paymentBtn = document.getElementById('paymentBtn');
            showLoading(paymentBtn);
            
            // Simulate payment process
            setTimeout(() => {
                const totalAmount = parseInt(document.getElementById('totalPayAmount').textContent);
                
                // Create booking
                const booking = {
                    id: Date.now().toString(),
                    userPhone: currentUser.phone,
                    vehicleId: currentVehicle.id,
                    vehicleName: currentVehicle.name,
                    vehicleNumber: currentVehicle.number,
                    duration: selectedDuration,
                    startTime: null,
                    endTime: null,
                    totalPaid: totalAmount,
                    status: 'pending_approval',
                    createdAt: new Date().toISOString()
                };
                
                bookings.push(booking);
                saveToLocalStorage('redigo_bookings', bookings);
                currentBooking = booking;
                
                // Update vehicle availability
                const vehicleIndex = vehicles.findIndex(v => v.id === currentVehicle.id);
                if (vehicleIndex !== -1) {
                    vehicles[vehicleIndex].available = false;
                }
                
                hideLoading(paymentBtn, 'Proceed to Payment');
                closeModal();
                showBookingConfirmation(booking);
            }, 2000);
        }

        // Show booking confirmation
        function showBookingConfirmation(booking) {
            document.getElementById('bookingDetails').innerHTML = `
                <div class="fare-row">
                    <span>Vehicle:</span>
                    <span>${booking.vehicleName} (${booking.vehicleNumber})</span>
                </div>
                <div class="fare-row">
                    <span>Duration:</span>
                    <span>${booking.duration}</span>
                </div>
                <div class="fare-row">
                    <span>Amount Paid:</span>
                    <span>‚Çπ${booking.totalPaid}</span>
                </div>
                <div class="fare-row">
                    <span>Status:</span>
                    <span style="color: #ff9800; font-weight: bold;">Waiting for Approval</span>
                </div>
            `;
            
            showScreen('bookingConfirmScreen');
        }

        // Close modal
        function closeModal() {
            document.getElementById('bookingModal').classList.remove('show');
            selectedDuration = null;
            document.querySelectorAll('.time-option').forEach(option => {
                option.classList.remove('selected');
            });
            document.getElementById('paymentBtn').disabled = true;
        }

        // Load active ride
        function loadActiveRide(ride) {
            currentBooking = ride;
            rideStartTime = new Date(ride.startTime);
            document.getElementById('rideVehicleInfo').textContent = `${ride.vehicleName} (${ride.vehicleNumber})`;
            showScreen('activeRideScreen');
            startRideTimer();
        }

        // Start ride timer
        function startRideTimer() {
            rideTimer = setInterval(() => {
                const now = new Date();
                const elapsed = now - rideStartTime;
                
                const hours = Math.floor(elapsed / (1000 * 60 * 60));
                const minutes = Math.floor((elapsed % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((elapsed % (1000 * 60)) / 1000);
                
                document.getElementById('rideTimer').textContent = 
                    `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                
                // Calculate fare
                const totalMinutes = Math.floor(elapsed / (1000 * 60));
                const fare = Math.ceil((totalMinutes / 60) * 60); // Round up to nearest hour
                document.getElementById('currentFare').textContent = fare;
                document.getElementById('totalAmount').textContent = fare + 300; // Add deposit
                
            }, 1000);
        }

        // End ride
        function endRide() {
            if (confirm('Are you sure you want to end the ride?')) {
                const endRideBtn = document.getElementById('endRideBtn');
                showLoading(endRideBtn);
                
                setTimeout(() => {
                    // Update booking status
                    const bookingIndex = bookings.findIndex(b => b.id === currentBooking.id);
                    if (bookingIndex !== -1) {
                        bookings[bookingIndex].status = 'pending_end_approval';
                        bookings[bookingIndex].endTime = new Date().toISOString();
                        saveToLocalStorage('redigo_bookings', bookings);
                    }
                    
                    clearInterval(rideTimer);
                    hideLoading(endRideBtn, 'End Ride');
                    alert('Ride end request sent to admin for approval. Please wait...');
                    showScreen('waitingScreen');
                }, 1500);
            }
        }

        // Admin Functions
        function showAdminSection(sectionName) {
            // Update sidebar active state
            document.querySelectorAll('.sidebar-item').forEach(item => {
                item.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Hide all sections
            document.querySelectorAll('.admin-section').forEach(section => {
                section.classList.add('hidden');
            });
            
            // Show selected section
            const sectionMap = {
                'dashboard': 'dashboardSection',
                'user-approvals': 'userApprovalsSection',
                'booking-approvals': 'bookingApprovalsSection',
                'active-rides': 'activeRidesSection',
                'users': 'usersSection',
                'vehicles': 'vehiclesSection',
                'analytics': 'analyticsSection'
            };
            
            const sectionId = sectionMap[sectionName];
            if (sectionId) {
                document.getElementById(sectionId).classList.remove('hidden');
                loadSectionData(sectionName);
            }
        }

        function loadSectionData(sectionName) {
            switch(sectionName) {
                case 'dashboard':
                    loadDashboardData();
                    break;
                case 'user-approvals':
                    loadUserApprovals();
                    break;
                case 'booking-approvals':
                    loadBookingApprovals();
                    break;
                case 'active-rides':
                    loadActiveRides();
                    break;
                case 'users':
                    loadAllUsers();
                    break;
                case 'vehicles':
                    loadVehicleManagement();
                    break;
                case 'analytics':
                    loadAnalytics();
                    break;
            }
        }

        function loadDashboardData() {
            // Update stats
            document.getElementById('totalUsersCount').textContent = users.length;
            document.getElementById('activeRidesCount').textContent = 
                bookings.filter(b => b.status === 'active').length;
            document.getElementById('availableVehiclesCount').textContent = 
                vehicles.filter(v => v.available).length;
            document.getElementById('pendingApprovalsCount').textContent = 
                users.filter(u => !u.approved).length + bookings.filter(b => b.status === 'pending_approval').length;
            
            // Calculate today's revenue
            const today = new Date().toISOString().split('T')[0];
            const todayBookings = bookings.filter(b => 
                b.createdAt && b.createdAt.startsWith(today) && b.status === 'completed'
            );
            const todayRevenue = todayBookings.reduce((sum, booking) => sum + (booking.finalFare || 0), 0);
            document.getElementById('todayRevenueCount').textContent = todayRevenue;
        }

        function loadUserApprovals() {
            const container = document.getElementById('pendingUserApprovals');
            const pendingUsers = users.filter(u => !u.approved);
            
            if (pendingUsers.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 50px; color: #666;">No pending user approvals</div>';
                return;
            }
            
            container.innerHTML = pendingUsers.map(user => `
                <div class="approval-card">
                    <div class="approval-header">
                        <div class="user-info">
                            <h4>${user.name}</h4>
                            <p>üìû +91 ${user.phone}</p>
                            <p style="font-size: 0.9em; color: #666;">Registered: ${new Date(user.registeredAt).toLocaleDateString()}</p>
                        </div>
                        <div class="approval-actions">
                            <button class="btn btn-success" onclick="approveUser('${user.phone}')">
                                Approve
                            </button>
                            <button class="btn btn-danger" onclick="rejectUser('${user.phone}')">
                                Reject
                            </button>
                        </div>
                    </div>
                    <div class="documents-grid">
                        <div class="document-preview">
                            <h5>Driving License</h5>
                            <p>üìÑ ${user.dlDocument}</p>
                        </div>
                        <div class="document-preview">
                            <h5>PAN Card</h5>
                            <p>üìÑ ${user.panDocument}</p>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function loadBookingApprovals() {
            const container = document.getElementById('pendingBookingApprovals');
            const pendingBookings = bookings.filter(b => b.status === 'pending_approval');
            
            if (pendingBookings.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 50px; color: #666;">No pending booking approvals</div>';
                return;
            }
            
            container.innerHTML = pendingBookings.map(booking => `
                <div class="approval-card">
                    <div class="approval-header">
                        <div class="user-info">
                            <h4>Booking #${booking.id}</h4>
                            <p>üìû +91 ${booking.userPhone}</p>
                            <p>üèçÔ∏è ${booking.vehicleName} (${booking.vehicleNumber})</p>
                            <p>‚è±Ô∏è Duration: ${booking.duration}</p>
                            <p style="color: #2e7d32; font-weight: bold;">üí∞ Paid: ‚Çπ${booking.totalPaid}</p>
                        </div>
                        <div class="approval-actions">
                            <button class="btn btn-success" onclick="approveBooking('${booking.id}')">
                                Start Ride
                            </button>
                            <button class="btn btn-danger" onclick="rejectBooking('${booking.id}')">
                                Reject
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function loadActiveRides() {
            const container = document.getElementById('activeRidesList');
            const activeBookings = bookings.filter(b => b.status === 'active' || b.status === 'pending_end_approval');
            
            if (activeBookings.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 50px; color: #666;">No active rides</div>';
                return;
            }
            
            container.innerHTML = activeBookings.map(booking => {
                const startTime = new Date(booking.startTime);
                const now = new Date();
                const elapsed = now - startTime;
                const hours = Math.floor(elapsed / (1000 * 60 * 60));
                const minutes = Math.floor((elapsed % (1000 * 60 * 60)) / (1000 * 60));
                const currentFare = Math.ceil((elapsed / (1000 * 60 * 60)) * 60);
                
                return `
                    <div class="approval-card">
                        <div class="approval-header">
                            <div class="user-info">
                                <h4>üèçÔ∏è ${booking.vehicleName} (${booking.vehicleNumber})</h4>
                                <p>üìû +91 ${booking.userPhone}</p>
                                <p>‚è±Ô∏è Duration: ${hours}h ${minutes}m</p>
                                <p style="color: #2e7d32; font-weight: bold;">üí∞ Current Fare: ‚Çπ${currentFare}</p>
                                <p>Status: <span style="color: ${booking.status === 'active' ? '#2e7d32' : '#ff9800'}">${booking.status.replace('_', ' ').toUpperCase()}</span></p>
                            </div>
                            <div class="approval-actions">
                                ${booking.status === 'pending_end_approval' ? 
                                    `<button class="btn btn-success" onclick="endRideApproval('${booking.id}', ${currentFare + 300})">
                                        End Ride
                                    </button>` : ''
                                }
                                <button class="btn btn-warning" onclick="contactUser('${booking.userPhone}')">
                                    Contact User
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function loadAllUsers() {
            const container = document.getElementById('allUsersList');
            
            if (users.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 50px; color: #666;">No users registered</div>';
                return;
            }
            
            container.innerHTML = users.map(user => {
                const userBookings = bookings.filter(b => b.userPhone === user.phone);
                const totalRides = userBookings.length;
                const totalSpent = userBookings.reduce((sum, b) => sum + (b.finalFare || b.totalPaid || 0), 0);
                
                return `
                    <div class="approval-card">
                        <div class="approval-header">
                            <div class="user-info">
                                <h4>${user.name} ${user.approved ? '‚úÖ' : '‚è≥'}</h4>
                                <p>üìû +91 ${user.phone}</p>
                                <p>üìä Total Rides: ${totalRides}</p>
                                <p style="color: #2e7d32;">üí∞ Total Spent: ‚Çπ${totalSpent}</p>
                                <p style="font-size: 0.9em; color: #666;">Joined: ${new Date(user.registeredAt).toLocaleDateString()}</p>
                            </div>
                            <div class="approval-actions">
                                ${!user.approved ? 
                                    `<button class="btn btn-success" onclick="approveUser('${user.phone}')">Approve</button>` : 
                                    `<button class="btn btn-warning" onclick="contactUser('${user.phone}')">Contact</button>`
                                }
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function loadVehicleManagement() {
            const container = document.getElementById('vehicleManagement');
            
            container.innerHTML = vehicles.map(vehicle => {
                const activeBooking = bookings.find(b => 
                    b.vehicleId === vehicle.id && b.status === 'active'
                );
                
                return `
                    <div class="approval-card">
                        <div class="approval-header">
                            <div class="user-info">
                                <h4>üèçÔ∏è ${vehicle.name}</h4>
                                <p>üè∑Ô∏è ${vehicle.number}</p>
                                <p>üìç Station: ${vehicle.station}</p>
                                <p>Status: <span style="color: ${vehicle.available ? '#2e7d32' : '#f44336'}">
                                    ${vehicle.available ? 'Available' : 'In Use'}
                                </span></p>
                                ${activeBooking ? `<p>üë§ User: +91 ${activeBooking.userPhone}</p>` : ''}
                            </div>
                            <div class="approval-actions">
                                <button class="btn btn-${vehicle.available ? 'warning' : 'success'}" 
                                    onclick="toggleVehicleAvailability(${vehicle.id})">
                                    ${vehicle.available ? 'Mark Unavailable' : 'Mark Available'}
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function loadAnalytics() {
            const container = document.getElementById('analyticsData');
            
            // Calculate analytics
            const totalRevenue = bookings.reduce((sum, b) => sum + (b.finalFare || b.totalPaid || 0), 0);
            const completedRides = bookings.filter(b => b.status === 'completed').length;
            const avgRideValue = completedRides > 0 ? (totalRevenue / completedRides).toFixed(2) : 0;
            
            // Monthly data
            const monthlyData = {};
            bookings.forEach(booking => {
                const month = booking.createdAt ? booking.createdAt.substring(0, 7) : '2024-01';
                monthlyData[month] = (monthlyData[month] || 0) + (booking.finalFare || booking.totalPaid || 0);
            });
            
            container.innerHTML = `
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value">‚Çπ${totalRevenue}</div>
                        <div class="stat-label">Total Revenue</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${completedRides}</div>
                        <div class="stat-label">Completed Rides</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">‚Çπ${avgRideValue}</div>
                        <div class="stat-label">Avg Ride Value</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${users.filter(u => u.approved).length}</div>
                        <div class="stat-label">Active Users</div>
                    </div>
                </div>
                
                <div style="margin-top: 30px;">
                    <h3 style="color: #000000; margin-bottom: 20px;">Monthly Revenue</h3>
                    <div style="background: white; padding: 20px; border-radius: 10px; border: 2px solid #4caf50;">
                        ${Object.entries(monthlyData).map(([month, revenue]) => `
                            <div style="display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #e8f5e8;">
                                <span>${new Date(month + '-01').toLocaleDateString('en-US', { month: 'long', year: 'numeric' })}</span>
                                <span style="color: #2e7d32; font-weight: bold;">‚Çπ${revenue}</span>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        // Admin action functions
        function approveUser(phone) {
            if (confirm('Approve this user?')) {
                const userIndex = users.findIndex(u => u.phone === phone);
                if (userIndex !== -1) {
                    users[userIndex].approved = true;
                    users[userIndex].approvedAt = new Date().toISOString();
                    saveToLocalStorage('redigo_users', users);
                    
                    showNotification('User approved successfully!', 'success');
                    loadUserApprovals();
                    loadDashboardData();
                    
                    // Auto-redirect user if they're currently waiting
                    if (currentUser && currentUser.phone === phone && 
                        document.getElementById('waitingScreen').classList.contains('hidden') === false) {
                        setTimeout(() => {
                            showNotification('Your account has been approved! Redirecting to stations...', 'success');
                            setTimeout(() => {
                                showScreen('stationsScreen');
                                updateStationAvailability();
                            }, 1500);
                        }, 1000);
                    }
                }
            }
        }

        function rejectUser(phone) {
            if (confirm('Reject this user? This action cannot be undone.')) {
                const userIndex = users.findIndex(u => u.phone === phone);
                if (userIndex !== -1) {
                    users.splice(userIndex, 1);
                    saveToLocalStorage('redigo_users', users);
                    
                    showNotification('User rejected and removed.', 'error');
                    loadUserApprovals();
                    loadDashboardData();
                }
            }
        }

        function approveBooking(bookingId) {
            if (confirm('Approve this booking and start the ride?')) {
                const bookingIndex = bookings.findIndex(b => b.id === bookingId);
                if (bookingIndex !== -1) {
                    const booking = bookings[bookingIndex];
                    bookings[bookingIndex].status = 'active';
                    bookings[bookingIndex].startTime = new Date().toISOString();
                    saveToLocalStorage('redigo_bookings', bookings);
                    
                    showNotification('Booking approved! Ride started.', 'success');
                    loadBookingApprovals();
                    loadDashboardData();
                    
                    // Auto-redirect user if they're currently waiting for booking approval
                    if (currentUser && currentUser.phone === booking.userPhone && 
                        (document.getElementById('bookingConfirmScreen').classList.contains('hidden') === false ||
                         document.getElementById('waitingScreen').classList.contains('hidden') === false)) {
                        setTimeout(() => {
                            showNotification('Your booking has been approved! Starting your ride...', 'success');
                            setTimeout(() => {
                                currentBooking = booking;
                                loadActiveRide(booking);
                            }, 1500);
                        }, 1000);
                    }
                }
            }
        }

        function rejectBooking(bookingId) {
            if (confirm('Reject this booking? The payment will be refunded.')) {
                const bookingIndex = bookings.findIndex(b => b.id === bookingId);
                if (bookingIndex !== -1) {
                    const booking = bookings[bookingIndex];
                    
                    // Make vehicle available again
                    const vehicleIndex = vehicles.findIndex(v => v.id === booking.vehicleId);
                    if (vehicleIndex !== -1) {
                        vehicles[vehicleIndex].available = true;
                    }
                    
                    bookings[bookingIndex].status = 'cancelled';
                    saveToLocalStorage('redigo_bookings', bookings);
                    
                    showNotification('Booking rejected. Refund will be processed.', 'warning');
                    loadBookingApprovals();
                    loadDashboardData();
                }
            }
        }

        function endRideApproval(bookingId, finalFare) {
            if (confirm(`End this ride? Final fare: ‚Çπ${finalFare}`)) {
                const bookingIndex = bookings.findIndex(b => b.id === bookingId);
                if (bookingIndex !== -1) {
                    const booking = bookings[bookingIndex];
                    
                    bookings[bookingIndex].status = 'completed';
                    bookings[bookingIndex].finalFare = finalFare;
                    bookings[bookingIndex].actualEndTime = new Date().toISOString();
                    
                    // Make vehicle available again
                    const vehicleIndex = vehicles.findIndex(v => v.id === booking.vehicleId);
                    if (vehicleIndex !== -1) {
                        vehicles[vehicleIndex].available = true;
                    }
                    
                    saveToLocalStorage('redigo_bookings', bookings);
                    
                    showNotification('Ride ended successfully!', 'success');
                    loadActiveRides();
                    loadDashboardData();
                }
            }
        }

        function toggleVehicleAvailability(vehicleId) {
            const vehicleIndex = vehicles.findIndex(v => v.id === vehicleId);
            if (vehicleIndex !== -1) {
                const vehicle = vehicles[vehicleIndex];
                const newStatus = !vehicle.available;
                
                if (confirm(`Mark ${vehicle.name} as ${newStatus ? 'available' : 'unavailable'}?`)) {
                    vehicles[vehicleIndex].available = newStatus;
                    
                    showNotification(`Vehicle marked as ${newStatus ? 'available' : 'unavailable'}`, 'success');
                    loadVehicleManagement();
                    loadDashboardData();
                }
            }
        }

        function contactUser(phone) {
            window.open(`tel:+91${phone}`, '_self');
        }

        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = 'notification-popup';
            notification.style.borderLeftColor = type === 'success' ? '#4caf50' : type === 'error' ? '#f44336' : '#ff9800';
            
            notification.innerHTML = `
                <h4 style="color: #000000; margin-bottom: 10px;">${type === 'success' ? '‚úÖ' : type === 'error' ? '‚ùå' : '‚ö†Ô∏è'} ${type.toUpperCase()}</h4>
                <p style="color: #424242;">${message}</p>
                <button onclick="this.parentElement.remove()" style="position: absolute; top: 10px; right: 10px; background: none; border: none; font-size: 16px; cursor: pointer;">√ó</button>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                if (notification.parentElement) {
                    notification.remove();
                }
            }, 5000);
        }

        function loadAdminData() {
            loadDashboardData();
        }

        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                currentUser = null;
                currentVehicle = null;
                selectedDuration = null;
                selectedStation = null;
                currentBooking = null;
                
                // Clear forms
                document.getElementById('phoneNumber').value = '';
                document.getElementById('otpInput').value = '';
                document.getElementById('adminPassword').value = '';
                
                showScreen('loginScreen');
            }
        }

        // Initialize app
        document.addEventListener('DOMContentLoaded', () => {
            showScreen('loginScreen');
            
            // Update station availability on load
            updateStationAvailability();
            
            // Auto logout after 30 minutes of inactivity (except during active rides)
            let inactivityTimer;
            function resetInactivityTimer() {
                clearTimeout(inactivityTimer);
                inactivityTimer = setTimeout(() => {
                    if (!rideTimer && !currentUser?.isAdmin) {
                        alert('Session expired due to inactivity. Please login again.');
                        logout();
                    }
                }, 30 * 60 * 1000);
            }

            document.addEventListener('click', resetInactivityTimer);
            document.addEventListener('keypress', resetInactivityTimer);
            resetInactivityTimer();
            
            // Auto-check for approvals every 10 seconds when user is waiting
            setInterval(() => {
                // Check if user is on waiting screen and check for approval
                if (!document.getElementById('waitingScreen').classList.contains('hidden') && currentUser && !currentUser.isAdmin) {
                    const user = users.find(u => u.phone === currentUser.phone);
                    if (user && user.approved) {
                        showNotification('Your account has been approved! Redirecting to stations...', 'success');
                        setTimeout(() => {
                            showScreen('stationsScreen');
                            updateStationAvailability();
                        }, 1500);
                    }
                }
                
                // Check if user is on booking confirmation screen and check for booking approval
                if (!document.getElementById('bookingConfirmScreen').classList.contains('hidden') && currentBooking) {
                    const booking = bookings.find(b => b.id === currentBooking.id);
                    if (booking && booking.status === 'active') {
                        showNotification('Your booking has been approved! Starting your ride...', 'success');
                        setTimeout(() => {
                            loadActiveRide(booking);
                        }, 1500);
                    }
                }
            }, 10000); // Check every 10 seconds
        });

        // Handle browser back button
        window.addEventListener('popstate', (e) => {
            // Prevent accidental navigation during active rides
            if (rideTimer) {
                e.preventDefault();
                if (confirm('You have an active ride. Are you sure you want to leave?')) {
                    // Allow navigation
                } else {
                    window.history.pushState(null, null, window.location.pathname);
                }
            }
        });

        // Prevent accidental page refresh during active rides
        window.addEventListener('beforeunload', (e) => {
            if (rideTimer) {
                e.preventDefault();
                e.returnValue = 'You have an active ride. Are you sure you want to leave?';
            }
        });
    </script>
</body>
</html>
